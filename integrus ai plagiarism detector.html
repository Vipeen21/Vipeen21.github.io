<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrus: Plagiarism & AI Detector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            background-color: #fef2f2;
            color: #dc2626;
            border-color: #fecaca;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <!-- Header -->
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-5xl md:text-7xl font-bold text-blue-900">Integrus</h1>
            <p class="text-md md:text-lg text-gray-600 mt-2">University-Level Plagiarism & AI Content Analysis. It opens in your local browser and doesn't store any data. It's a free and open source project.</p>
        </header>

        <main class="max-w-4xl mx-auto">
            <!-- Input Section -->
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200">
                <label for="textContent" class="block text-lg font-semibold text-gray-700 mb-4">Submit Your Research Paper</label>
                <textarea id="textContent" rows="15" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Paste your text here... (up to 5000 words)"></textarea>
                <div class="flex justify-between items-center mt-4">
                    <p id="wordCount" class="text-sm text-gray-500">Word Count: 0 / 5000</p>
                    <button id="checkButton" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-200 disabled:bg-gray-400">
                        Analyze Content
                    </button>
                </div>
                <div class="mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <p class="text-sm text-orange-700">
                        <strong>Disclaimer:</strong> AI plagiarism apps can assist in identifying potential instances of plagiarism. However, it is important to note that their results are not fully accurate! Please use this information responsibly and don't make the decision based on this tool completely.
                    </p>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden mt-6 p-4 rounded-lg border error-message"></div>

            <!-- Results Section (Initially Hidden) -->
            <div id="resultsSection" class="mt-10 hidden">
                <div id="loader" class="text-center hidden my-8">
                    <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24 mx-auto"></div>
                    <p class="mt-4 text-gray-600 font-semibold">Performing live web analysis... This may take a moment.</p>
                </div>

                <div id="resultsContent" class="hidden">
                     <h2 class="text-2xl md:text-3xl font-bold text-center mb-8">Analysis Report</h2>
                    <!-- Score Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div id="plagiarismScoreCard" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 text-center">
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">Plagiarism Score</h3>
                            <p id="plagiarismPercentage" class="text-5xl font-bold"></p>
                            <p id="plagiarismVerdict" class="text-md mt-2 font-medium"></p>
                        </div>
                        <div id="aiScoreCard" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 text-center">
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">AI Content Detector</h3>
                            <p id="aiPercentage" class="text-5xl font-bold"></p>
                            <p id="aiVerdict" class="text-md mt-2 font-medium"></p>
                        </div>
                    </div>

                    <!-- Source Breakdown -->
                    <div>
                        <h3 class="text-xl md:text-2xl font-bold mb-4">Source Analysis</h3>
                        <div id="sourceList" class="space-y-4">
                            <!-- Dynamic source items will be injected here -->
                        </div>
                         <div id="noSourcesFound" class="hidden bg-white p-6 rounded-lg shadow-md border border-gray-200 text-center">
                            <p class="text-gray-600 font-semibold">No significant sources of plagiarism were found.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-12 text-sm text-gray-500">
            <p>&copy; 2024 Integrus. For educational and demonstrative purposes only.</p>
        </footer>
    </div>

    <script>
        // --- DOM Elements ---
        const textContent = document.getElementById('textContent');
        const wordCountDisplay = document.getElementById('wordCount');
        const checkButton = document.getElementById('checkButton');
        const errorMessage = document.getElementById('errorMessage');
        const resultsSection = document.getElementById('resultsSection');
        const loader = document.getElementById('loader');
        const resultsContent = document.getElementById('resultsContent');
        const plagiarismPercentage = document.getElementById('plagiarismPercentage');
        const plagiarismVerdict = document.getElementById('plagiarismVerdict');
        const aiPercentage = document.getElementById('aiPercentage');
        const aiVerdict = document.getElementById('aiVerdict');
        const sourceList = document.getElementById('sourceList');
        const noSourcesFound = document.getElementById('noSourcesFound');
        const plagiarismScoreCard = document.getElementById('plagiarismScoreCard');
        const aiScoreCard = document.getElementById('aiScoreCard');

        const WORD_LIMIT = 5000;

        // --- Event Listeners ---
        textContent.addEventListener('input', () => {
            const text = textContent.value;
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            const count = words.length;

            wordCountDisplay.textContent = `Word Count: ${count} / ${WORD_LIMIT}`;
            errorMessage.classList.add('hidden');

            if (count > WORD_LIMIT) {
                wordCountDisplay.classList.add('text-red-600', 'font-semibold');
                checkButton.disabled = true;
            } else {
                wordCountDisplay.classList.remove('text-red-600', 'font-semibold');
                checkButton.disabled = count < 10; // Disable if less than 10 words
            }
        });

        checkButton.addEventListener('click', async () => {
            // 1. Reset UI and show loader
            resultsSection.classList.remove('hidden');
            resultsContent.classList.add('hidden');
            errorMessage.classList.add('hidden');
            loader.classList.remove('hidden');
            checkButton.disabled = true;
            checkButton.textContent = 'Analyzing...';
            sourceList.innerHTML = ''; // Clear previous sources
            noSourcesFound.classList.add('hidden');

            try {
                const userInput = textContent.value;
                
                // 3. Perform analysis using Gemini API for plagiarism
                const plagiarismResult = await livePlagiarismCheck(userInput);
                const aiResult = simulateAIDetection(userInput); // Keep AI detection simulated

                // 4. Display results
                displayResults(plagiarismResult, aiResult);

            } catch (error) {
                console.error("Analysis Error:", error);
                errorMessage.textContent = `An error occurred during analysis: ${error.message}. Please try again.`;
                errorMessage.classList.remove('hidden');
            } finally {
                // 5. Hide loader and show content/reset button
                loader.classList.add('hidden');
                if (!errorMessage.classList.contains('hidden')) {
                     resultsSection.classList.add('hidden');
                } else {
                     resultsContent.classList.remove('hidden');
                }
                checkButton.disabled = false;
                checkButton.textContent = 'Analyze Content';
            }
        });
        
        // --- Live Plagiarism Check using Gemini API ---
        async function livePlagiarismCheck(userInput) {
            const sentences = userInput.match(/[^.!?]+[.!?]+/g) || [];
            if (sentences.length < 2) {
                return { percentage: 0, sources: [] };
            }

            // Select representative sentences to check
            const sentencesToCheck = [
                sentences[0],
                sentences[Math.floor(sentences.length / 3)],
                sentences[Math.floor(sentences.length * 2 / 3)],
                sentences[sentences.length - 1]
            ].filter((v, i, a) => v && a.indexOf(v) === i).slice(0, 5); // Unique sentences, max 5

            const prompt = `
                You are a plagiarism detection API. I will provide you with a few sentences from a document.
                For each sentence, find the most likely online source.
                Then, for each source you find, estimate a "matchPercentage" representing how much of the user's *entire document* likely matches this source. This is an estimate. A higher percentage means a more significant match.
                Return a single JSON object with a "sources" key, containing an array. Each object in the array should have "url", "text" (the matched sentence), and "matchPercentage".
                Only return sources with a credible match. If no sources are found, return an empty array.
                
                Example format:
                {
                  "sources": [
                    { "url": "www.example.com/source1", "text": "The first sentence that matched...", "matchPercentage": 25 },
                    { "url": "www.anotherexample.net/article", "text": "Another sentence that was found...", "matchPercentage": 10 }
                  ]
                }

                Here are the sentences to check from the document:
                ${sentencesToCheck.map(s => `- ${s.trim()}`).join('\n')}
            `;
            
            const apiKey = "AIzaSyANUZqC85Od1i7sfI4BIqoOjL8R-RIgO6o"; // API key is handled by the execution environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "sources": {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        "url": { type: "STRING" },
                                        "text": { type: "STRING" },
                                        "matchPercentage": { type: "NUMBER" }
                                    },
                                    required: ["url", "text", "matchPercentage"]
                                }
                            }
                        }
                    }
                }
            };

            const apiResponse = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!apiResponse.ok) {
                throw new Error(`API request failed with status ${apiResponse.status}`);
            }

            const result = await apiResponse.json();
            const foundSourcesText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (!foundSourcesText) {
                 return { percentage: 0, sources: [] };
            }

            const foundSourcesData = JSON.parse(foundSourcesText);
            const sources = foundSourcesData.sources || [];
            
            // The overall plagiarism score is the highest percentage from any single source
            const overallPercentage = sources.reduce((max, source) => Math.max(max, source.matchPercentage), 0);

            return {
                percentage: Math.round(overallPercentage),
                sources: sources
            };
        }


        // --- Simulation Logic (AI Detection) ---
        function simulateAIDetection(userInput) {
            const sentences = userInput.split('.').filter(s => s.trim().length > 0);
            if (sentences.length < 2) return { percentage: Math.floor(Math.random() * 20) };
            
            const avgSentenceLength = userInput.length / sentences.length;
            let score = 0;

            if (avgSentenceLength > 100) score += 20;
            else if (avgSentenceLength > 80) score += 10;

            const aiKeywords = ['delve', 'tapestry', 'leverage', 'in conclusion', 'it is important to note', 'moreover', 'furthermore', 'navigating the complexities'];
            aiKeywords.forEach(keyword => {
                if (userInput.toLowerCase().includes(keyword)) {
                    score += 8;
                }
            });

            score += Math.floor(Math.random() * 25);
            return { percentage: Math.min(100, score) };
        }

        // --- UI Update Logic ---
        function displayResults(plagiarismResult, aiResult) {
            plagiarismPercentage.textContent = `${plagiarismResult.percentage}%`;
            updateCard(plagiarismScoreCard, plagiarismVerdict, plagiarismResult.percentage, 
                { low: 'Low Risk', medium: 'Medium Risk', high: 'High Risk' },
                { low: 'text-green-600', medium: 'text-yellow-600', high: 'text-red-600' }
            );

            aiPercentage.textContent = `${aiResult.percentage}%`;
            updateCard(aiScoreCard, aiVerdict, aiResult.percentage, 
                { low: 'Likely Human-Written', medium: 'Potentially AI-Generated', high: 'Likely AI-Generated' },
                { low: 'text-green-600', medium: 'text-yellow-600', high: 'text-red-600' }
            );

            if (plagiarismResult.sources && plagiarismResult.sources.length > 0) {
                 plagiarismResult.sources.sort((a, b) => b.matchPercentage - a.matchPercentage);
                plagiarismResult.sources.forEach(source => {
                    const sourceElement = document.createElement('div');
                    sourceElement.className = 'bg-white p-4 rounded-lg shadow-md border border-gray-200 flex items-start sm:items-center justify-between flex-col sm:flex-row gap-4';
                    sourceElement.innerHTML = `
                        <div class="flex-grow">
                            <p class="font-semibold text-blue-700 break-all">${source.url}</p>
                            <blockquote class="mt-2 border-l-4 border-gray-300 pl-4 text-gray-600 italic text-sm">
                                Matched text: "${source.text}"
                            </blockquote>
                        </div>
                        <div class="text-2xl font-bold text-red-500 flex-shrink-0">${Math.round(source.matchPercentage)}%</div>
                    `;
                    sourceList.appendChild(sourceElement);
                });
            } else {
                noSourcesFound.classList.remove('hidden');
            }
        }

        function updateCard(cardElement, verdictElement, percentage, verdicts, colors) {
            let level = 'low';
            if (percentage > 50) level = 'high';
            else if (percentage > 20) level = 'medium';

            verdictElement.textContent = verdicts[level];
            
            Object.values(colors).forEach(color => {
                verdictElement.classList.remove(color);
                cardElement.classList.remove(color.replace('text', 'border'));
            });

            verdictElement.classList.add(colors[level]);
            cardElement.classList.add(colors[level].replace('text', 'border'));
            cardElement.style.borderWidth = '2px';
        }

    </script>
</body>
</html>
